Some code can be replaced by function, avoiding duplication